{% extends "base.html" %}

{% block title %}Historique des Entretiens{% endblock %}
{% block page_title %}Historique des Entretiens{% endblock %}

{% block content %}
<a href="{% url 'entretien_create' %}" class="btn btn-success"><i class="fa-solid fa-plus"></i> Ajouter un Entretien</a>

{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }} mt-3">{{ message }}</div>
{% endfor %}
{% endif %}

<div class="card shadow-sm p-4 rounded-3 mt-4">
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th>Véhicule</th>
            <th>Date</th>
            <th>Kilométrage</th>
            <th>Type</th>
            <th>Fournisseur</th>
            <th>Coût Total (€)</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for entretien in entretiens %}
        <tr>
            <td>{{ entretien.vehicule.matricule }}</td>
            <td>{{ entretien.date_entretien|date:"d/m/Y" }}</td>
            <td>{{ entretien.kilometrage }} km</td>
            <td>{{ entretien.depense_type|default:"-" }}</td>
            <td>{{ entretien.fournisseur.nom|default:"Non spécifié" }}</td>
            <td>
                {% if entretien.cout_calcule %}
                <strong>{{ entretien.cout_calcule|floatformat:2 }}</strong>
                {% else %}
                <span class="text-danger">0.00</span>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'entretien_update' pk=entretien.id %}" class="btn btn-sm btn-primary"><i class="fas fa-edit"></i></a>
                <a href="{% url 'entretien_delete' pk=entretien.id %}" class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7">Aucun entretien enregistré.</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}